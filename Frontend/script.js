const BACKEND_URL = '/api'; // This is the only URL you will ever need.

document.addEventListener('DOMContentLoaded', () => {
    // All of your existing, working logic from before goes here.
    // I am providing the full, clean code to prevent any mistakes.
    const navPreMeeting=document.getElementById("nav-pre-meeting"),navPostMeeting=document.getElementById("nav-post-meeting"),preMeetingSection=document.getElementById("pre-meeting-section"),postMeetingSection=document.getElementById("post-meeting-section");navPreMeeting.addEventListener("click",()=>{navPreMeeting.classList.add("active"),navPostMeeting.classList.remove("active"),preMeetingSection.classList.remove("hidden"),postMeetingSection.classList.add("hidden")}),navPostMeeting.addEventListener("click",()=>{navPostMeeting.classList.add("active"),navPreMeeting.classList.remove("active"),postMeetingSection.classList.remove("hidden"),preMeetingSection.classList.add("hidden")});const scheduleBtn=document.getElementById("schedule-btn"),reminderTitleInput=document.getElementById("reminder-title"),reminderStartTimeInput=document.getElementById("reminder-start-time"),reminderEndTimeInput=document.getElementById("reminder-end-time"),reminderMessageInput=document.getElementById("reminder-message"),attendeeEmailsInput=document.getElementById("attendee-emails"),scheduleStatusContainer=document.getElementById("schedule-status-container"),meetingLinkContainer=document.getElementById("meeting-link-container"),meetingLinkOutput=document.getElementById("meeting-link-output"),copyLinkBtn=document.getElementById("copy-link-btn");const pollForMeetingLink=e=>{const t=setInterval(async()=>{try{const o=await fetch(`${BACKEND_URL}/get-meeting-link/${e}`);if(o.ok){const n=await o.json();n.hangoutLink&&(clearInterval(t),scheduleStatusContainer.textContent="Success! Meeting scheduled and link received.",meetingLinkOutput.value=n.hangoutLink,meetingLinkContainer.classList.remove("hidden"))}}catch(o){console.error("Polling error:",o)}},3e3);setTimeout(()=>clearInterval(t),6e4)};scheduleBtn.addEventListener("click",async()=>{const e=reminderTitleInput.value.trim(),t=reminderStartTimeInput.value,o=reminderEndTimeInput.value,n=reminderMessageInput.value.trim(),i=attendeeEmailsInput.value.trim().split(",").map(a=>a.trim()).filter(a=>a);if(!e||!t||!o||!n)return void alert("Please fill out all fields in the Pre-Meeting section.");scheduleBtn.disabled=!0,scheduleBtn.textContent="Scheduling...",scheduleStatusContainer.classList.add("hidden"),meetingLinkContainer.classList.add("hidden");try{const a=await fetch(`${BACKEND_URL}/schedule-reminder`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:e,startTime:t,endTime:o,message:n,attendees:i})}),s=await a.json();if(!a.ok)throw new Error(s.detail);scheduleStatusContainer.textContent=s.message,scheduleStatusContainer.className="status-box status-success",scheduleStatusContainer.classList.remove("hidden"),s.meetingId&&pollForMeetingLink(s.meetingId)}catch(a){scheduleStatusContainer.textContent=`Error: ${a.message}`,scheduleStatusContainer.className="status-box status-error",scheduleStatusContainer.classList.remove("hidden")}finally{scheduleBtn.disabled=!1,scheduleBtn.textContent="Complete Setup & Schedule"}}),copyLinkBtn.addEventListener("click",()=>{meetingLinkOutput.select(),document.execCommand("copy"),copyLinkBtn.textContent="Copied!",setTimeout(()=>copyLinkBtn.textContent="Copy",2e3)});const processBtn=document.getElementById("process-btn"),audioFileInput=document.getElementById("audio-file-input"),fileLabel=document.getElementById("file-label"),progressContainer=document.getElementById("progress-container"),progressBarInner=document.getElementById("progress-bar-inner"),statusText=document.getElementById("status-text"),resultsContainer=document.getElementById("results-container"),summaryOutput=document.getElementById("summary-output"),transcriptOutput=document.getElementById("transcript-output");const fetchHistory=async()=>{try{const e=await fetch(`${BACKEND_URL}/meetings`);if(!e.ok)throw new Error("Could not fetch history.");const t=await e.json();const o=document.getElementById("history-list");if(o.innerHTML="",0===t.length)return void(o.innerHTML="<li>No recent meetings found.</li>");t.forEach(n=>{const i=document.createElement("li"),a=new Date(n.upload_timestamp).toLocaleString();i.innerHTML=`<strong>${n.filename}</strong><span>Processed on: ${date}</span>`,i.addEventListener("click",()=>{summaryOutput.innerText=n.summary,transcriptOutput.innerText=n.transcript,resultsContainer.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"})}),o.appendChild(i)})}catch(e){console.error("Failed to fetch history:",e),document.getElementById("history-list").innerHTML="<li>Error loading history.</li>"}};audioFileInput.addEventListener("change",()=>{fileLabel.textContent=audioFileInput.files.length>0?audioFileInput.files[0].name:"Choose an audio file..."}),processBtn.addEventListener("click",async()=>{const e=audioFileInput.files[0];if(!e)return void alert("Please select an audio file first.");processBtn.disabled=!0,processBtn.style.display="none",resultsContainer.classList.add("hidden"),progressContainer.classList.remove("hidden"),progressBarInner.style.backgroundColor="#3949ab",progressBarInner.style.width="100%",statusText.textContent="Uploading & Processing... (This can take a minute)";const t=new FormData;t.append("file",e);try{const o=await fetch(`${BACKEND_URL}/transcribe-and-summarize`,{method:"POST",body:t}),n=await o.json();if(!o.ok)throw new Error(n.detail||"An unknown error occurred during processing.");summaryOutput.innerText=n.summary,transcriptOutput.innerText=n.transcript,resultsContainer.classList.remove("hidden"),progressContainer.classList.add("hidden"),fetchHistory()}catch(o){console.error("An error occurred:",o),statusText.innerHTML=`<strong>Error:</strong> ${o.message}`,progressBarInner.style.backgroundColor="#d9534f"}finally{processBtn.disabled=!1,processBtn.style.display="block"}}),fetchHistory()
});